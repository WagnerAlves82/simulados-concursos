"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[819],{2660:function(e,a,s){s.d(a,{Z:function(){return r}});let r=(0,s(9763).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},7648:function(e,a,s){s.d(a,{default:function(){return t.a}});var r=s(2972),t=s.n(r)},5819:function(e,a,s){s.d(a,{ProtectedAdminRoute:function(){return x},N:function(){return f}});var r=s(7437),t=s(2265),n=s(5648),i=s(5526);class l{async isAdmin(e){try{let{data:a}=await this.supabase.from("profiles").select("plano, email").eq("id",e).single();if((null==a?void 0:a.email)==="wagnerjuniorsouza@gmail.com")return!0;return(null==a?void 0:a.plano)==="admin"||(null==a?void 0:a.plano)==="superadmin"}catch(e){return console.error("Erro ao verificar admin:",e),!1}}async getUserRole(e){try{let{data:a}=await this.supabase.from("profiles").select("plano, email").eq("id",e).single();if((null==a?void 0:a.email)==="wagnerjuniorsouza@gmail.com")return"superadmin";if((null==a?void 0:a.plano)==="admin"||(null==a?void 0:a.plano)==="superadmin")return"admin";return"user"}catch(e){return console.error("Erro ao obter role:",e),"user"}}async getUserPermissions(e){return({user:{canViewAdmin:!1,canCreateQuestoes:!1,canEditQuestoes:!1,canDeleteQuestoes:!1,canManageCargos:!1,canManageUsers:!1,canExportData:!1,canUploadBulk:!1},admin:{canViewAdmin:!0,canCreateQuestoes:!0,canEditQuestoes:!0,canDeleteQuestoes:!1,canManageCargos:!0,canManageUsers:!1,canExportData:!0,canUploadBulk:!0},superadmin:{canViewAdmin:!0,canCreateQuestoes:!0,canEditQuestoes:!0,canDeleteQuestoes:!0,canManageCargos:!0,canManageUsers:!0,canExportData:!0,canUploadBulk:!0}})[await this.getUserRole(e)]}async promoverUsuario(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"admin";try{let{error:s}=await this.supabase.from("profiles").update({plano:a}).eq("email",e);if(s)throw s;return!0}catch(e){return console.error("Erro ao promover usu\xe1rio:",e),!1}}async removerAdmin(e){try{if("wagnerjuniorsouza@gmail.com"===e)throw Error("N\xe3o \xe9 poss\xedvel remover privil\xe9gios do super admin");let{error:a}=await this.supabase.from("profiles").update({plano:"gratuito"}).eq("email",e);if(a)throw a;return!0}catch(e){return console.error("Erro ao remover admin:",e),!1}}async listarUsuarios(){try{let{data:e,error:a}=await this.supabase.from("profiles").select("id, email, nome, plano, created_at, ultimo_acesso").order("created_at",{ascending:!1});if(a)throw a;return(null==e?void 0:e.map(e=>({...e,role:"wagnerjuniorsouza@gmail.com"===e.email?"superadmin":"admin"===e.plano||"superadmin"===e.plano?"admin":"user"})))||[]}catch(e){return console.error("Erro ao listar usu\xe1rios:",e),[]}}async logAction(e,a,s){try{await this.supabase.from("admin_logs").insert({user_id:e,action:a,details:s?JSON.stringify(s):null,timestamp:new Date().toISOString()})}catch(e){console.error("Erro ao registrar log:",e)}}constructor(){this.supabase=(0,i.e)()}}var o=s(9820),c=s(2381),d=s(7648),m=s(9763);let u=(0,m.Z)("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]),h=(0,m.Z)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var p=s(2660);function x(e){let{children:a,requiredPermission:s="canViewAdmin",fallback:i}=e,{user:m}=(0,n.a)(),[x,f]=(0,t.useState)(null),[g,j]=(0,t.useState)(!0),[w,b]=(0,t.useState)(!1);(0,t.useEffect)(()=>{N()},[m,s]);let N=async()=>{if(!m){j(!1);return}try{let e=new l,a=await e.getUserPermissions(m.id);f(a),b(a[s]),await e.logAction(m.id,"admin_access_attempt",{permission:s,granted:a[s]})}catch(e){console.error("Erro ao verificar permiss\xf5es:",e),b(!1)}finally{j(!1)}};return g?(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 flex items-center justify-center",children:(0,r.jsx)(o.Zb,{className:"w-96",children:(0,r.jsxs)(o.aY,{className:"p-8 text-center",children:[(0,r.jsx)(u,{className:"h-12 w-12 mx-auto mb-4 text-blue-600 animate-pulse"}),(0,r.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Verificando Permiss\xf5es"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Validando acesso administrativo..."})]})})}):m?w?(0,r.jsx)(r.Fragment,{children:a}):i?(0,r.jsx)(r.Fragment,{children:i}):(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 flex items-center justify-center",children:(0,r.jsx)(o.Zb,{className:"w-96",children:(0,r.jsxs)(o.aY,{className:"p-8 text-center",children:[(0,r.jsx)(u,{className:"h-12 w-12 mx-auto mb-4 text-red-600"}),(0,r.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Acesso Restrito"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"Voc\xea n\xe3o tem permiss\xe3o para acessar esta \xe1rea administrativa."}),x&&(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[(0,r.jsx)("h3",{className:"font-medium mb-2",children:"Suas Permiss\xf5es:"}),(0,r.jsxs)("div",{className:"text-sm space-y-1",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Visualizar Admin:"}),(0,r.jsx)("span",{className:x.canViewAdmin?"text-green-600":"text-red-600",children:x.canViewAdmin?"✓":"✗"})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Criar Quest\xf5es:"}),(0,r.jsx)("span",{className:x.canCreateQuestoes?"text-green-600":"text-red-600",children:x.canCreateQuestoes?"✓":"✗"})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Upload em Lote:"}),(0,r.jsx)("span",{className:x.canUploadBulk?"text-green-600":"text-red-600",children:x.canUploadBulk?"✓":"✗"})]})]})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Entre em contato com o administrador para solicitar acesso."}),(0,r.jsx)(d.default,{href:"/dashboard",children:(0,r.jsxs)(c.z,{variant:"outline",className:"w-full",children:[(0,r.jsx)(p.Z,{className:"h-4 w-4 mr-2"}),"Voltar ao Dashboard"]})})]})]})})}):(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 flex items-center justify-center",children:(0,r.jsx)(o.Zb,{className:"w-96",children:(0,r.jsxs)(o.aY,{className:"p-8 text-center",children:[(0,r.jsx)(h,{className:"h-12 w-12 mx-auto mb-4 text-amber-600"}),(0,r.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Acesso Negado"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"Voc\xea precisa estar logado para acessar esta \xe1rea."}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)(d.default,{href:"/login",children:(0,r.jsx)(c.z,{className:"w-full",children:"Fazer Login"})}),(0,r.jsx)(d.default,{href:"/",children:(0,r.jsxs)(c.z,{variant:"outline",className:"w-full",children:[(0,r.jsx)(p.Z,{className:"h-4 w-4 mr-2"}),"Voltar ao In\xedcio"]})})]})]})})})}function f(){let{user:e}=(0,n.a)(),[a,s]=(0,t.useState)(null),[r,i]=(0,t.useState)(!0);(0,t.useEffect)(()=>{e?o():i(!1)},[e]);let o=async()=>{if(e)try{let a=new l,r=await a.getUserPermissions(e.id);s(r)}catch(e){console.error("Erro ao verificar permiss\xf5es:",e)}finally{i(!1)}};return{permissions:a,loading:r,hasPermission:e=>(null==a?void 0:a[e])||!1,isAdmin:(null==a?void 0:a.canViewAdmin)||!1}}}}]);